C51 COMPILER V9.60.7.0   LCD1602                                                           11/20/2025 06:54:59 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN .\Objects\lcd1602.obj
COMPILER INVOKED BY: D:\C51\BIN\C51.EXE lcd1602.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\lcd1602.l
                    -st) OBJECT(.\Objects\lcd1602.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          #define uchar unsigned char
   4          #define uint  unsigned int
   5          
   6          /// 数据总线
   7          #define lcd_data_port P0
   8          
   9          /// 控制信号引脚
  10          sbit lcd_rs = P2^6;
  11          sbit lcd_rw = P2^5;
  12          sbit lcd_en = P2^7;
  13          
  14          /// 延时参数
  15          static const uint AWAIT = 1;
  16          
  17          /**
  18           * [ASCII到LCD1602字符集映射]
  19           * 
  20           * 静态函数
  21           * 
  22           * 将ASCII字符映射到LCD1602字符集的对应编码
  23           * 对于LCD1602不支持的字符，返回空格(0x20)
  24           */
  25          static uchar ascii_to_lcd_char(
  26              char ascii_char /* 要映射的ASCII字符 */
  27          ) 
  28          {
  29   1          uchar lcd_char;  // 在函数开头定义变量
  30   1          
  31   1          // 确保字符在LCD1602支持的范围内
  32   1          if(ascii_char < 0x20) {
  33   2              return 0x20; /// 映射到空格
  34   2          }
  35   1          
  36   1          if(ascii_char > 0x7F) {
  37   2              return 0x20; /// 映射到空格
  38   2          }
  39   1          
  40   1          /// 特殊字符映射处理
  41   1          switch(ascii_char) {
  42   2              case '\0': /// 字符串结束符
  43   2              case '\n': /// 换行符
  44   2              case '\r': /// 回车符
  45   2              case '\t': /// 制表符
  46   2                  return 0x20; /// 映射到空格
  47   2              
  48   2              default: 
  49   2                  return ascii_char; /// 大多数ASCII字符在LCD1602中直接支持
  50   2          }
  51   1      }
*** WARNING C280 IN LINE 29 OF lcd1602.c: 'lcd_char': unreferenced local variable
  52          
  53          /**
C51 COMPILER V9.60.7.0   LCD1602                                                           11/20/2025 06:54:59 PAGE 2   

  54           * [毫秒级延时函数]
  55           * 
  56           * 静态函数
  57           * 
  58           * 只是用循环来简单模拟，缺陷是对于不同的设备表现不一致。
  59           */
  60          static void lcd_delay(
  61              uint t /* 延时时间 */
  62          ) 
  63          {
  64   1          uchar j;  // 在函数开头定义变量
  65   1          
  66   1          while(t--) {
  67   2              j = 85;
  68   2              while (j--);
  69   2          }
  70   1      }
  71          
  72          /**
  73           * [LCD1602写命令]
  74           * 
  75           * 静态函数
  76           */
  77          static void lcd_write_command(
  78              uchar command /* 要写入的命令 */
  79          ) 
  80          {
  81   1          lcd_rs = 0;
  82   1          lcd_rw = 0;
  83   1          lcd_data_port = command;
  84   1          lcd_en = 1;
  85   1          lcd_delay(AWAIT);
  86   1          lcd_en = 0;
  87   1          lcd_delay(AWAIT);
  88   1      }
  89          
  90          /**
  91           * [LCD1602写数据]
  92           * 
  93           * 静态函数
  94           */
  95          static void lcd_write_data(
  96              uchar input_data /* 要写入的数据 */
  97          ) 
  98          {
  99   1          lcd_rs = 1;
 100   1          lcd_rw = 0;
 101   1          lcd_data_port = input_data;
 102   1          lcd_en = 1;
 103   1          lcd_delay(AWAIT);
 104   1          lcd_en = 0;
 105   1          lcd_delay(AWAIT);
 106   1      }
 107          
 108          /**
 109           * [LCD1602设置光标位置]
 110           * 
 111           * 静态函数
 112           * 
 113           * [`line`] = 1..2
 114           * [`column`] = 1..16
 115           */
C51 COMPILER V9.60.7.0   LCD1602                                                           11/20/2025 06:54:59 PAGE 3   

 116          static void lcd_set_cursor(
 117              uchar line, /* 行位置 */
 118              uchar column /* 列位置 */
 119          ) 
 120          {
 121   1          if(line == 1) {
 122   2              lcd_write_command(0x80 | (column - 1));
 123   2          }
 124   1          else if(line == 2) {
 125   2              lcd_write_command(0x80 | (column - 1 + 0x40));
 126   2          }
 127   1      }
 128          
 129          /**
 130           * [LCD1602初始化函数]
 131           */
 132          void lcd_init() 
 133          {
 134   1          lcd_write_command(0x38); /* 8位数据接口，2行显示，5×8点阵 */
 135   1          lcd_write_command(0x0C); /* 显示开，光标关，闪烁关 */
 136   1          lcd_write_command(0x06); /* 读写后光标右移，显示不移动 */
 137   1          lcd_write_command(0x01); /* 清屏 */
 138   1      }
 139          
 140          /**
 141           * [在LCD1602指定位置上显示一个字符]
 142           * 
 143           * [`line`] = 1..2
 144           * [`column`] = 1..16
 145           */
 146          void lcd_show_char(
 147              uchar line, /* 行位置 */
 148              uchar column, /* 列位置 */
 149              char input_char /* 要显示的字符 */
 150          ) 
 151          {
 152   1          uchar lcd_char;  // 在函数开头定义变量
 153   1          
 154   1          lcd_set_cursor(line, column);
 155   1          lcd_char = ascii_to_lcd_char(input_char);
 156   1          lcd_write_data(lcd_char);
 157   1      }
 158          
 159          /**
 160           * [在LCD1602指定位置开始显示所给字符串]
 161           * 
 162           * [`line`] = 1..2
 163           * [`column`] = 1..16
 164           */
 165          void lcd_show_string(
 166              uchar line, /* 起始行位置 */
 167              uchar column, /* 起始列位置 */
 168              char *input_string /* 要显示的字符串 */
 169          ) 
 170          {
 171   1          uchar i;        // 在函数开头定义变量
 172   1          uchar lcd_char; // 在函数开头定义变量
 173   1          
 174   1          lcd_set_cursor(line, column);
 175   1          for(i = 0; input_string[i] != '\0'; i++) {
 176   2              lcd_char = ascii_to_lcd_char(input_string[i]);
 177   2              lcd_write_data(lcd_char);
C51 COMPILER V9.60.7.0   LCD1602                                                           11/20/2025 06:54:59 PAGE 4   

 178   2          }
 179   1      }
 180          
 181          /**
 182           * [创建自定义字符]
 183           * 
 184           * [`char_code`] = 0..7 (CGRAM地址)
 185           * [`char_map`] = 字符点阵数据(8字节)
 186           */
 187          void lcd_create_char(
 188              uchar char_code, /* CGRAM地址(0-7) */
 189              uchar char_map[] /* 字符点阵数据数组 */
 190          ) 
 191          {
 192   1          uchar i;  // 在函数开头定义变量
 193   1          
 194   1          lcd_write_command(0x40 | (char_code << 3)); /// 设置CGRAM地址
 195   1          for(i = 0; i < 8; i++) {
 196   2              lcd_write_data(char_map[i]);
 197   2          }
 198   1          lcd_write_command(0x80); /// 返回DDRAM地址
 199   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    249    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
