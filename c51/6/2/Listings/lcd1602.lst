C51 COMPILER V9.60.7.0   LCD1602                                                           11/21/2025 20:03:44 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN .\Objects\lcd1602.obj
COMPILER INVOKED BY: D:\C51\BIN\C51.EXE lcd1602.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\lcd1602.l
                    -st) OBJECT(.\Objects\lcd1602.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "delay.h"
   3          
   4          #define uchar unsigned char
   5          #define uint  unsigned int
   6          
   7          /// 数据总线
   8          #define lcd_data_port P0
   9          
  10          /// 控制信号引脚
  11          sbit lcd_rs = P2^6;
  12          sbit lcd_rw = P2^5;
  13          sbit lcd_en = P2^7;
  14          
  15          /// 延时参数
  16          static const uint AWAIT = 1;
  17          
  18          /**
  19           * [ASCII到LCD1602字符集映射]
  20           * 
  21           * 静态函数
  22           * 
  23           * 将ASCII字符映射到LCD1602字符集的对应编码
  24           * 对于LCD1602不支持的字符，返回空格(0x20)
  25           */
  26          static uchar ascii_to_lcd_char(
  27              char ascii_char /* 要映射的ASCII字符 */
  28          ) 
  29          {
  30   1          // 确保字符在LCD1602支持的范围内
  31   1          if(ascii_char < 0x20) {
  32   2              return 0x20; /// 映射到空格
  33   2          }
  34   1          
  35   1          if(ascii_char > 0x7F) {
  36   2              return 0x20; /// 映射到空格
  37   2          }
  38   1          
  39   1          /// 特殊字符映射处理
  40   1          switch(ascii_char) {
  41   2              case '\0': /// 字符串结束符
  42   2              case '\n': /// 换行符
  43   2              case '\r': /// 回车符
  44   2              case '\t': /// 制表符
  45   2                  return 0x20; /// 映射到空格
  46   2              
  47   2              default: 
  48   2                  return ascii_char; /// 大多数ASCII字符在LCD1602中直接支持
  49   2          }
  50   1      }
  51          
  52          /**
  53           * [LCD1602写命令]
  54           * 
C51 COMPILER V9.60.7.0   LCD1602                                                           11/21/2025 20:03:44 PAGE 2   

  55           * 静态函数
  56           */
  57          static void lcd_write_command(
  58              uchar command /* 要写入的命令 */
  59          ) 
  60          {
  61   1          lcd_rs = 0;
  62   1          lcd_rw = 0;
  63   1          lcd_data_port = command;
  64   1          lcd_en = 1;
  65   1          delay_ms(AWAIT);
  66   1          lcd_en = 0;
  67   1          delay_ms(AWAIT);
  68   1      }
  69          
  70          /**
  71           * [LCD1602写数据]
  72           * 
  73           * 静态函数
  74           */
  75          static void lcd_write_data(
  76              uchar input_data /* 要写入的数据 */
  77          ) 
  78          {
  79   1          lcd_rs = 1;
  80   1          lcd_rw = 0;
  81   1          lcd_data_port = input_data;
  82   1          lcd_en = 1;
  83   1          delay_ms(AWAIT);
  84   1          lcd_en = 0;
  85   1          delay_ms(AWAIT);
  86   1      }
  87          
  88          /**
  89           * [LCD1602设置光标位置]
  90           * 
  91           * 静态函数
  92           * 
  93           * [`line`] = 1..2
  94           * [`column`] = 1..16
  95           */
  96          static void lcd_set_cursor(
  97              uchar line, /* 行位置 */
  98              uchar column /* 列位置 */
  99          ) 
 100          {
 101   1          if(line == 1) {
 102   2              lcd_write_command(0x80 | (column - 1));
 103   2          }
 104   1          else if(line == 2) {
 105   2              lcd_write_command(0x80 | (column - 1 + 0x40));
 106   2          }
 107   1      }
 108          
 109          /**
 110           * [LCD1602初始化函数]
 111           */
 112          void lcd_init() 
 113          {
 114   1          lcd_write_command(0x38); /* 8位数据接口，2行显示，5×8点阵 */
 115   1          lcd_write_command(0x0C); /* 显示开，光标关，闪烁关 */
 116   1          lcd_write_command(0x06); /* 读写后光标右移，显示不移动 */
C51 COMPILER V9.60.7.0   LCD1602                                                           11/21/2025 20:03:44 PAGE 3   

 117   1          lcd_write_command(0x01); /* 清屏 */
 118   1      }
 119          
 120          /**
 121           * [在LCD1602指定位置上显示一个字符]
 122           * 
 123           * [`line`] = 1..2
 124           * [`column`] = 1..16
 125           */
 126          void lcd_show_char(
 127              uchar line, /* 行位置 */
 128              uchar column, /* 列位置 */
 129              char input_char /* 要显示的字符 */
 130          ) 
 131          {
 132   1          uchar lcd_char;
 133   1          
 134   1          lcd_set_cursor(line, column);
 135   1          lcd_char = ascii_to_lcd_char(input_char);
 136   1          lcd_write_data(lcd_char);
 137   1      }
 138          
 139          /**
 140           * [在LCD1602指定位置开始显示所给字符串]
 141           * 
 142           * [`line`] = 1..2
 143           * [`column`] = 1..16
 144           */
 145          void lcd_show_string(
 146              uchar line, /* 起始行位置 */
 147              uchar column, /* 起始列位置 */
 148              char *input_string /* 要显示的字符串 */
 149          ) 
 150          {
 151   1          uchar i;
 152   1          uchar lcd_char;
 153   1          
 154   1          lcd_set_cursor(line, column);
 155   1          for(i = 0; input_string[i] != '\0'; i++) {
 156   2              lcd_char = ascii_to_lcd_char(input_string[i]);
 157   2              lcd_write_data(lcd_char);
 158   2          }
 159   1      }
 160          
 161          /**
 162           * [在LCD1602指定位置显示无符号数字]
 163           * 
 164           * [`line`] = 1..2
 165           * [`column`] = 1..16
 166           * [`number`] = 0..65535
 167           * [`length`] = 1..5
 168           */
 169          void lcd_show_num(
 170              uchar line,     /* 行位置 */
 171              uchar column,   /* 列位置 */
 172              uint number,    /* 要显示的数字 */
 173              uchar length    /* 数字长度 */
 174          ) 
 175          {
 176   1          uchar i;
 177   1          uint divisor = 1;
 178   1          uchar digit;
C51 COMPILER V9.60.7.0   LCD1602                                                           11/21/2025 20:03:44 PAGE 4   

 179   1          
 180   1          // 计算除数
 181   1          for(i = 1; i < length; i++) {
 182   2              divisor *= 10;
 183   2          }
 184   1          
 185   1          lcd_set_cursor(line, column);
 186   1          for(i = 0; i < length; i++) {
 187   2              digit = (number / divisor) % 10;
 188   2              lcd_write_data(digit + '0');
 189   2              divisor /= 10;
 190   2          }
 191   1      }
 192          
 193          /**
 194           * [在LCD1602指定位置显示有符号数字]
 195           * 
 196           * [`line`] = 1..2
 197           * [`column`] = 1..16
 198           * [`number`] = -32768..32767
 199           * [`length`] = 1..5
 200           */
 201          void lcd_show_signed_num(
 202              uchar line,     /* 行位置 */
 203              uchar column,   /* 列位置 */
 204              int number,     /* 要显示的数字 */
 205              uchar length    /* 数字长度 */
 206          ) 
 207          {
 208   1          uchar i;
 209   1          uint divisor = 1;
 210   1          uchar digit;
 211   1          uint number_abs;
 212   1          
 213   1          lcd_set_cursor(line, column);
 214   1          
 215   1          // 显示符号
 216   1          if(number >= 0) {
 217   2              lcd_write_data('+');
 218   2              number_abs = number;
 219   2          }
 220   1          else {
 221   2              lcd_write_data('-');
 222   2              number_abs = -number;
 223   2          }
 224   1          
 225   1          // 计算除数
 226   1          for(i = 1; i < length; i++) {
 227   2              divisor *= 10;
 228   2          }
 229   1          
 230   1          // 显示数字
 231   1          for(i = 0; i < length; i++) {
 232   2              digit = (number_abs / divisor) % 10;
 233   2              lcd_write_data(digit + '0');
 234   2              divisor /= 10;
 235   2          }
 236   1      }
 237          
 238          /**
 239           * [在LCD1602指定位置显示十六进制数字]
 240           * 
C51 COMPILER V9.60.7.0   LCD1602                                                           11/21/2025 20:03:44 PAGE 5   

 241           * [`line`] = 1..2
 242           * [`column`] = 1..16
 243           * [`number`] = 0..65535
 244           * [`length`] = 1..4
 245           */
 246          void lcd_show_hex_num(
 247              uchar line,     /* 行位置 */
 248              uchar column,   /* 列位置 */
 249              uint number,    /* 要显示的数字 */
 250              uchar length    /* 数字长度 */
 251          ) 
 252          {
 253   1          uchar i;
 254   1          uchar digit;
 255   1          
 256   1          lcd_set_cursor(line, column);
 257   1          for(i = 0; i < length; i++) {
 258   2              digit = (number >> (4 * (length - 1 - i))) & 0x0F;
 259   2              if(digit < 10) {
 260   3                  lcd_write_data(digit + '0');
 261   3              }
 262   2              else {
 263   3                  lcd_write_data(digit - 10 + 'A');
 264   3              }
 265   2          }
 266   1      }
 267          
 268          /**
 269           * [在LCD1602指定位置显示二进制数字]
 270           * 
 271           * [`line`] = 1..2
 272           * [`column`] = 1..16
 273           * [`number`] = 0..65535
 274           * [`length`] = 1..16
 275           */
 276          void lcd_show_bin_num(
 277              uchar line,     /* 行位置 */
 278              uchar column,   /* 列位置 */
 279              uint number,    /* 要显示的数字 */
 280              uchar length    /* 数字长度 */
 281          ) 
 282          {
 283   1          uchar i;
 284   1          
 285   1          lcd_set_cursor(line, column);
 286   1          for(i = 0; i < length; i++) {
 287   2              lcd_write_data(((number >> (length - 1 - i)) & 0x01) + '0');
 288   2          }
 289   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    562    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2      41
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
